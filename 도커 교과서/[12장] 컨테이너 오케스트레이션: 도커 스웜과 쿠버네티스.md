운영 환경에서도 여전히 애플리케이션은 컨테이너에서 실행되지만, 여러 대의 도커 호스트와 컨테이너를 관리해주는 관리 레이거가 한 층 추가된다. 이 관리 레이어를 오케스트레이션이라고 하며, 주요 오케스트레이션 도구로 도커 스웜(Docker Swarm)과 쿠버네티스(Kubernetes)가 있다.

# 12.1 컨테이너 오케스트레이션 도구란?

도커 컴포즈는 단일 도커 호스트에서 컨테이너를 실행하기 위한 도구였다. 하지만 운영 환경은 단일 호스트로만 구성되지 않는다. 단일 호스트 환경에서는 호스트 한 대만 고장을 일으켜도 전체 애플리케이션이 중단된다. 서비스 운영을 위한 시스템은 고가용성을 요구하는데, 이 때문에 오케스트레이션이 필요해진다. 오케스트레이션 도구란 기본적으로 클러스터를 구성하는 여러 대의 호스트 컴퓨터를 의미한다. 오케스트레이션 도구는 컨테이너를 관리하고, 서비스를 제공하기 위한 작업을 여러 컴퓨터에 분배하며, 네트워크 트래픽 부하를 고르게 분산시키고, 상태가 불량한 컨테이너를 새 컨테이너로 교체하는 일을 담당한다.

여러 대의 호스트에 도커를 설치해 클러스터를 만들고 나면, 이들 컴퓨터를 오케스트레이션 플랫폼에 등록한다. 그 다음부터는 명령행 도구나 웹 UI를 통해 원격에서 클러스터를 관리할 수 있다.

오케스트레이션 도구에는 컨테이너의 잠재력을 한층 더 살릴 수 있는 기능이 있다. 클러스터에는 클러스터에 배포된 애플리케이션에 대한 모든 정보가 담긴 분산 데이터베이스와 어떤 컨테이너를 어떤 호스트에서 실행할지 배정하는 스케줄러, 클러스터를 구성하는 호스트 간에 주기적으로 연락 신호를 주고받는 시스템이 있는데, 이들 시스템은 클러스터의 신뢰성을 확보하는 기본적인 수단이 된다. 클러스터에 애플리케이션을 배포하려면 클러스터에 YAML 파일을 전달하면 된다. 그러면 클러스터가 애플리케이션 구성 정보를 저장하고 그에 맞춰 동원 가능한 서버에서 컨테이너를 생성해 애플리케이션을 실행한다. 애플리케이션이 실행되면 클러스터는 애플리케이션의 실행 상태가 유지되도록 관리한다. 어떤 서버가 고장 나면 컨테이너 일부가 손실되겠지만, 클러스터가 다른 서버에서 대체 컨테이너를 실행한다.

복잡한 컨테이너 관리는 모두 오케스트레이션 도구가 대신해 준다. 우리는 YAML에 원하는 애플리케이션의 상태를 작성하기만 하면 되며, 어떤 서버에서 몇 개의 컨테이너를 실행해야 할지는 신경 쓰지 않아도 된다. 게다가 오케스트레이션 도구는 네트워크 관련 기능, 애플리케이션 설정 기능, 데이터 저장 기능도 제공한다.

# 12.2 도커 스웜으로 클러스터 만들기